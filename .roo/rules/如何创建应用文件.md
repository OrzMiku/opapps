# 如何创建应用文件

本文档为 Roo Code (AI) 提供了一套完整的、用于创建和维护新应用的标准化规则。严格遵守这些规则可以确保所有应用都具有一致的结构、清晰的配置和良好的可维护性。

---

## 1. 标准文件结构

所有新应用都 **必须** 遵循以下文件结构。

```
/应用名称 (e.g., /gitea)
├── data.yml             # [必需] 应用的核心元数据文件
├── logo.png             # [必需] 应用的图标 (推荐 256x256)
├── README.md            # [推荐] 应用的中文说明文档
├── README_en.md         # [可选] 应用的英文说明文档
│
└── /版本号或变体名 (e.g., /24.3.0 or /latest-mysql)
    ├── data.yml         # [必需] 定义此版本的安装配置表单
    └── docker-compose.yml # [必需] 定义此版本的 Docker 服务
```

> 补充：文档只需要对应用进行简单介绍即可，不需要复制完整的项目Readme，中英文Readme之间不需要相互跳转的链接

### 1.1. 命名规范

- **应用名称 (目录名)**: 必须使用小写字母、数字和连字符 `-` 的组合。例如：`gitea`, `mysql-cluster`。
- **版本号/变体名**:
  - 对于有明确版本的应用，使用语义化版本号，例如 `24.3.0`。
  - 对于提供不同配置变体的应用，使用 `latest-[变体特征]` 的格式，例如 `latest-mysql`, `latest-sqlite`。

---

## 2. 配置文件详解

### 2.1. 根 `data.yml` (元数据)

此文件定义了应用的“身份”，用于在应用商店中展示。

| 字段路径                              | 类型    | 是否必需 | 说明                                                                 |
| :------------------------------------ | :------ | :------- | :------------------------------------------------------------------- |
| `name`                                | String  | 是       | 应用的官方显示名称。                                                 |
| `tags`                                | Array   | 是       | 应用的分类标签 (中文)。                                              |
| `title`                               | String  | 是       | 应用的一句话简介，突出核心功能。                                     |
| `description`                         | String  | 是       | 应用的详细描述。                                                     |
| `additionalProperties.key`            | String  | 是       | 应用的唯一英文标识，**必须与根目录名完全一致**。                     |
| `additionalProperties.shortDescZh`    | String  | 是       | 应用的中文短描述。                                                   |
| `additionalProperties.shortDescEn`    | String  | 是       | 应用的英文短描述。                                                   |
| `additionalProperties.type`           | String  | 是       | 应用类型。常见值：`website`, `database`, `tool`, `language`。        |
| `additionalProperties.github`         | String  | 是       | 应用的 GitHub 仓库链接。                                             |
| `additionalProperties.document`       | String  | 推荐     | 应用的官方文档或帮助链接。                                           |
| `additionalProperties.website`        | String  | 推荐     | 应用的官方网站链接。                                                 |
| `additionalProperties.architectures`  | Array   | 是       | 支持的 CPU 架构列表。常见值：`amd64`, `arm64`。                      |
| `additionalProperties.deprecated`     | String  | 否       | **弃用标记**。值为版本号。当平台版本高于此值时，应用将被标记为弃用。 |
| `additionalProperties.gpuSupport`     | Boolean | 否       | **GPU 支持**。声明应用是否支持或需要 GPU 加速。                      |
| `additionalProperties.memoryRequired` | Number  | 否       | **内存要求**。应用运行所需的最小内存（RAM），单位为 MB。             |

### 2.2. 版本 `data.yml` (动态表单)

此文件是实现动态配置的核心，它通过 `additionalProperties.formFields` 数组定义了一个安装表单。

| 字段             | 类型          | 是否必需 | 说明                                                                                                                    |
| :--------------- | :------------ | :------- | :---------------------------------------------------------------------------------------------------------------------- |
| `type`           | String        | 是       | 表单项的 UI 类型。常见值：`text`, `password`, `number`, `textarea`, `select`, `service` (选择服务), `apps` (选择应用)。 |
| `key`            | String        | 是       | 表单项的唯一标识符。                                                                                                    |
| `envKey`         | String        | 是       | **核心字段**。此表单项的值将作为哪个环境变量注入到 Docker 容器中。                                                      |
| `label`          | Object        | 是       | **多语言标签**。一个包含多种语言翻译的对象，**必须**至少包含 `en` 和 `zh`。                                             |
| `default`        | String/Number | 推荐     | 表单项的默认值。                                                                                                        |
| `required`       | Boolean       | 否       | 是否为必填项。默认为 `false`。                                                                                          |
| `random`         | Boolean       | 否       | 若为 `true`，在用户未填写时可为其生成随机值 (常用于密码或用户名)。                                                      |
| `rule`           | String        | 否       | 输入验证规则的名称，如 `paramPort` (端口), `paramCommon` (通用字符)。                                                   |
| `values`         | Array         | 否       | 用于 `select` 类型。数组中的每个对象包含 `label` 和 `value`，定义下拉选项。                                             |
| `child`          | Object        | 否       | **子表单**。用于实现条件依赖的动态表单。                                                                                |
| `allowCreate`    | Boolean       | 否       | **允许创建**。若为 `true`，允许用户在表单中动态添加自定义的键值对或列表项。                                             |
| `disabled`       | Boolean       | 否       | **禁用字段**。若为 `true`，该表单项在 UI 上不可编辑。用于固定配置或依赖注入的场景。                                     |
| `multiple`       | Boolean       | 否       | **允许多选**。用于 `select` 类型，若为 `true`，允许用户选择多个选项。                                                   |
| `supportVersion` | String        | 否       | **平台版本要求**。声明此应用版本兼容的最低平台版本。                                                                    |

### 2.3. `docker-compose.yml` (服务定义)

此文件定义了如何运行应用的 Docker 服务。

- **环境变量**: 文件中 **必须** 使用 `${...}` 的语法来引用在版本 `data.yml` 中定义的 `envKey`。
  ```yaml
  environment:
    - MYSQL_HOST=${PANEL_DB_HOST}
    - MYSQL_DATABASE=${PANEL_DB_NAME}
    - API_KEYS=${API_KEYS}
  ```
- **网络**: 应用服务 **必须** 连接到 `1panel-network` 这个外部网络，以确保能与其他服务通信。

  ```yaml
  networks:
    - 1panel-network

  networks:
    1panel-network:
      external: true
  ```

- **容器名**: 容器名 **必须** 使用 `${CONTAINER_NAME}` 变量，由平台动态分配。
  ```yaml
  container_name: ${CONTAINER_NAME}
  ```

---

## 3. 创建新应用的完整流程

1.  **创建目录结构**: 根据第 1 节的规范，创建应用根目录和第一个版本/变体目录。
2.  **准备静态文件**: `README.md` 放入根目录，Logo 应该提醒由用户自行放入。
3.  **编写根 `data.yml`**: 根据第 2.1 节的字段规范，填写应用的基本元数据。
4.  **分析配置需求**: 确定应用需要哪些用户可配置的参数（如端口、密码、API 密钥、数据库连接等）。
5.  **编写版本 `data.yml`**: 为每一个配置需求，在 `formFields` 中创建一个对应的表单项，并为其指定 `envKey`。
6.  **编写 `docker-compose.yml`**: 编写服务定义，并使用 `${...}` 语法将 `envKey` 注入到容器的环境变量或端口映射中。
